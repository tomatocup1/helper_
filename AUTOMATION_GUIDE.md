# 🤖 자동화 시스템 사용 가이드

## 🎯 개요

**우리가게 도우미 다중 사용자 통합 자동화 시스템**은 모든 플랫폼의 리뷰 관리를 완전 자동화합니다.

### ✨ 주요 기능
- **다중 사용자 지원**: 1명부터 1000명까지 동시 처리
- **전체 플랫폼 지원**: 네이버, 배민, 요기요, 쿠팡이츠
- **완전 자동화**: 크롤링 → AI 답글 생성 → 답글 등록
- **병렬 처리**: 최대 동시 실행으로 시간 단축
- **안전한 인증**: Supabase DB의 암호화된 로그인 정보 사용

---

## 🚀 빠른 시작

### 1. 모든 사용자 전체 자동화 (추천)
```bash
cd C:\helper_B\backend
python automation_runner.py --all-users
```

### 2. 특정 사용자만 실행
```bash
python automation_runner.py --user-id "a7654c42-10ed-435f-97d8-d2c2dfeccbcb"
```

### 3. 특정 플랫폼만 실행
```bash
python automation_runner.py --all-users --platforms "naver,baemin"
```

---

## 📋 상세 명령어

### 기본 실행 옵션

#### 💻 실행 대상 선택
```bash
# 모든 활성 사용자 실행
--all-users

# 특정 사용자 실행 (사용자 UUID 필요)
--user-id "사용자-UUID"
```

#### 🔧 플랫폼 선택
```bash
# 모든 플랫폼 (기본값)
# 지정하지 않으면 naver, baemin, yogiyo, coupangeats 모두 실행

# 특정 플랫폼만
--platforms "naver,baemin"           # 네이버, 배민만
--platforms "yogiyo"                 # 요기요만
--platforms "naver,yogiyo,coupangeats"  # 쿠팡이츠 제외
```

#### ⚙️ 단계별 제어
```bash
# 크롤링 건너뛰기 (이미 최신 리뷰가 있는 경우)
--skip-crawling

# AI 답글 생성 건너뛰기 (이미 답글이 준비된 경우)
--skip-ai-reply

# 답글 등록 건너뛰기 (테스트 모드)
--skip-posting
```

#### 🏃 성능 최적화
```bash
# 최대 동시 실행 사용자 수 (기본값: 3)
--max-concurrent 5   # 5명까지 동시 처리
--max-concurrent 1   # 순차 처리 (안전 모드)
```

---

## 📖 사용 예시

### 🎯 실제 운영 시나리오

#### 1. **매일 정기 실행** (오전 9시, 오후 6시)
```bash
# 모든 사용자, 모든 플랫폼 완전 자동화
python automation_runner.py --all-users
```

#### 2. **특정 사용자 긴급 처리**
```bash
# 고객 문의로 인한 긴급 답글 처리
python automation_runner.py --user-id "a7654c42-10ed-435f-97d8-d2c2dfeccbcb"
```

#### 3. **플랫폼별 선택 실행**
```bash
# 네이버, 배민만 처리 (요기요, 쿠팡 제외)
python automation_runner.py --all-users --platforms "naver,baemin"
```

#### 4. **테스트 모드**
```bash
# 크롤링만 실행 (답글 생성/등록 제외)
python automation_runner.py --user-id "test-user" --skip-ai-reply --skip-posting

# AI 답글 생성만 테스트 (크롤링/등록 제외)
python automation_runner.py --user-id "test-user" --skip-crawling --skip-posting
```

#### 5. **대용량 처리 모드**
```bash
# 많은 사용자가 있을 때 동시 실행 수 증가
python automation_runner.py --all-users --max-concurrent 10
```

---

## 📊 실행 결과 해석

### ✅ 성공 예시
```
📊 자동화 실행 결과 요약
====================================
✅ 실행 상태: 성공
📝 메시지: 전체 자동화 완료: 3/3 사용자 성공
👥 대상 사용자: 3명
✅ 성공 사용자: 3명
❌ 실패 사용자: 0명
📥 크롤링: 8/10
🤖 AI 답글: 3/3
📤 답글 등록: 6/8
⏱️ 실행 시간: 245.3초
```

### ⚠️ 부분 실패 예시
```
📊 자동화 실행 결과 요약
====================================
✅ 실행 상태: 성공
📝 메시지: 전체 자동화 완료: 2/3 사용자 성공
👥 대상 사용자: 3명
✅ 성공 사용자: 2명
❌ 실패 사용자: 1명
📥 크롤링: 5/7
🤖 AI 답글: 2/2
📤 답글 등록: 4/5

❌ 실패한 사용자:
   - 김영희: 크롤링 타임아웃 (5분 초과)
```

---

## 🔧 문제 해결

### 자주 발생하는 문제들

#### 1. **사용자를 찾을 수 없습니다**
```
❌ 사용자를 찾을 수 없습니다: invalid-user-id
```
**해결책**: 올바른 사용자 UUID를 확인하세요.

#### 2. **처리할 매장이 없습니다**
```
⚠️ 처리할 매장이 없습니다: 홍길동
```
**해결책**:
- 매장이 등록되어 있는지 확인
- `is_active = true`로 설정되어 있는지 확인

#### 3. **크롤링 타임아웃**
```
❌ 크롤링 타임아웃 (5분 초과)
```
**해결책**:
- 네트워크 상태 확인
- 플랫폼 서버 상태 확인
- `--max-concurrent 1`로 순차 처리

#### 4. **로그인 정보 오류**
```
❌ 패스워드가 설정되지 않았습니다
```
**해결책**: 매장의 로그인 정보가 올바르게 암호화되어 저장되었는지 확인

---

## 📁 로그 확인

### 로그 파일 위치
```
C:\helper_B\backend\automation_20250915.log
```

### 로그 레벨
- `INFO`: 정상 진행 상황
- `WARNING`: 주의 필요한 상황
- `ERROR`: 오류 발생

### 실시간 로그 확인
```bash
# Windows
Get-Content automation_20250915.log -Wait

# 또는
tail -f automation_20250915.log
```

---

## 🔄 다음 단계: 스케줄러 설정

현재는 수동 실행이지만, 곧 다음 기능들이 추가됩니다:

1. **자동 스케줄러**: 매일 정해진 시간에 자동 실행
2. **웹 대시보드**: 실시간 상태 모니터링
3. **알림 시스템**: 성공/실패 알림
4. **AWS 배포**: 클라우드 서버에서 24시간 운영

---

## 💡 팁과 권장사항

### 🎯 운영 모범사례

1. **정기 실행**: 매일 오전 9시, 오후 6시 실행 권장
2. **순차 처리**: 문제 발생시 `--max-concurrent 1` 사용
3. **단계별 테스트**: 새로운 매장 추가시 단계별 테스트
4. **로그 모니터링**: 정기적으로 로그 파일 확인

### ⚡ 성능 최적화

- **동시 실행 수 조정**: 시스템 성능에 맞게 `--max-concurrent` 값 조정
- **플랫폼 분할**: 필요시 플랫폼별로 나누어 실행
- **시간대 분산**: 트래픽이 적은 시간대에 실행

### 🛡️ 안전성 확보

- **백업**: 중요한 변경 전에는 데이터베이스 백업
- **테스트**: 프로덕션 실행 전 테스트 모드로 검증
- **모니터링**: 실행 결과와 로그 정기 확인

---

## 📞 지원

문제가 발생하거나 개선 요청이 있으시면:

1. **로그 파일** 확인
2. **실행 명령어** 재확인
3. **에러 메시지** 기록
4. **기술 지원팀** 연락

**이제 수동 명령어 12개가 1개로 간소화되었습니다!** 🎉