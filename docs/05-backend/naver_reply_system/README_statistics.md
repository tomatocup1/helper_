# ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤ í†µê³„ í¬ë¡¤ë§ ì‹œìŠ¤í…œ

ê¸°ì¡´ ë„¤ì´ë²„ ë¦¬ë·° í¬ë¡¤ë§ ì‹œìŠ¤í…œì˜ ë¡œê·¸ì¸ ë©”ì»¤ë‹ˆì¦˜ì„ ì¬ì‚¬ìš©í•˜ì—¬ ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤ í†µê³„ í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” íŠ¹ì§•

### âœ¨ ê¸°ëŠ¥
- **ë°©ë¬¸ ì „ ì§€í‘œ**: í”Œë ˆì´ìŠ¤ ìœ ì…, ì˜ˆì•½Â·ì£¼ë¬¸ ì‹ ì²­, ìŠ¤ë§ˆíŠ¸ì½œ í†µí™”
- **ë°©ë¬¸ í›„ ì§€í‘œ**: ë¦¬ë·° ë“±ë¡  
- **ìœ ì… ë¶„ì„**: í‚¤ì›Œë“œë³„/ì±„ë„ë³„ ìˆœìœ„ ë°ì´í„°
- **URL ê¸°ë°˜ ë‚ ì§œ í•„í„°**: ë“œë¡­ë°•ìŠ¤ ì¡°ì‘ ì—†ì´ URL íŒŒë¼ë¯¸í„°ë¡œ ë‚ ì§œ ì§€ì •
- **ì¬ì‹œë„ ë¡œì§**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, ë¸Œë¼ìš°ì € ë¬¸ì œ ìë™ ì¬ì‹œë„
- **ë°°ì¹˜ ì²˜ë¦¬**: ì—¬ëŸ¬ ë§¤ì¥ ì¼ê´„ ì²˜ë¦¬

### ğŸ” ë³´ì•ˆ ê¸°ëŠ¥
- **2ì°¨ ì¸ì¦ ìš°íšŒ**: ê¸°ì¡´ ë¸Œë¼ìš°ì € í”„ë¡œí•„ ì¬ì‚¬ìš©
- **ì„¸ì…˜ ê´€ë¦¬**: ê³„ì •ë³„ ë…ë¦½ì ì¸ ë¸Œë¼ìš°ì € í”„ë¡œí•„
- **RLS ë³´ì•ˆ**: Supabase í–‰ ìˆ˜ì¤€ ë³´ì•ˆ ì ìš©

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
backend/scripts/
â”œâ”€â”€ naver_statistics_crawler.py     # ë©”ì¸ í†µê³„ í¬ë¡¤ë§ ì—”ì§„
â”œâ”€â”€ run_statistics_crawler.py       # ë°°ì¹˜ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ naver_login_auto.py             # ê¸°ì¡´ ë¡œê·¸ì¸ ì‹œìŠ¤í…œ (ì¬ì‚¬ìš©)
â””â”€â”€ sql/
    â””â”€â”€ create_statistics_naver_table.sql  # ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„± ìŠ¤í¬ë¦½íŠ¸
```

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### `statistics_naver` í…Œì´ë¸”

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì„¤ëª… |
|--------|------|------|
| `id` | UUID | ê¸°ë³¸í‚¤ |
| `platform_store_id` | UUID | ë§¤ì¥ ID (platform_stores ì°¸ì¡°) |
| `date` | DATE | í†µê³„ ë‚ ì§œ |
| `place_inflow` | INTEGER | í”Œë ˆì´ìŠ¤ ìœ ì… íšŸìˆ˜ |
| `place_inflow_change` | DECIMAL | í”Œë ˆì´ìŠ¤ ìœ ì… ì¦ê°ë¥  (%) |
| `reservation_order` | INTEGER | ì˜ˆì•½Â·ì£¼ë¬¸ ì‹ ì²­ íšŸìˆ˜ |
| `reservation_order_change` | DECIMAL | ì˜ˆì•½Â·ì£¼ë¬¸ ì¦ê°ë¥  (%) |
| `smart_call` | INTEGER | ìŠ¤ë§ˆíŠ¸ì½œ í†µí™” íšŸìˆ˜ |
| `smart_call_change` | DECIMAL | ìŠ¤ë§ˆíŠ¸ì½œ ì¦ê°ë¥  (%) |
| `review_registration` | INTEGER | ë¦¬ë·° ë“±ë¡ íšŸìˆ˜ |
| `review_registration_change` | DECIMAL | ë¦¬ë·° ë“±ë¡ ì¦ê°ë¥  (%) |
| `inflow_channels` | JSONB | ìœ ì… ì±„ë„ ìˆœìœ„ ë°ì´í„° |
| `inflow_keywords` | JSONB | ìœ ì… í‚¤ì›Œë“œ ìˆœìœ„ ë°ì´í„° |

## âš™ï¸ ì„¤ì¹˜ ë° ì„¤ì •

### 1. ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„±
```sql
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰
-- sql/create_statistics_naver_table.sql íŒŒì¼ ë‚´ìš© ì‹¤í–‰
```

### 2. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
```bash
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

### 3. Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
pip install playwright supabase python-dotenv
playwright install chromium
```

## ğŸ–¥ï¸ ì‚¬ìš©ë²•

### ë‹¨ì¼ ë§¤ì¥ í†µê³„ ìˆ˜ì§‘

```bash
# ê¸°ë³¸ ì‚¬ìš©ë²• (ì „ë‚  í†µê³„)
python naver_statistics_crawler.py \
  --email "account@naver.com" \
  --password "password" \
  --store-id "platform_store_id" \
  --user-id "user_uuid"

# íŠ¹ì • ë‚ ì§œ í†µê³„
python naver_statistics_crawler.py \
  --email "account@naver.com" \
  --password "password" \
  --store-id "platform_store_id" \
  --user-id "user_uuid" \
  --date "2025-08-17"

# í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ (ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰)
python naver_statistics_crawler.py \
  --email "account@naver.com" \
  --password "password" \
  --store-id "platform_store_id" \
  --user-id "user_uuid" \
  --headless
```

### ë°°ì¹˜ ì²˜ë¦¬ (ì—¬ëŸ¬ ë§¤ì¥ ì¼ê´„)

```bash
# ì „ì²´ ë§¤ì¥ ë°°ì¹˜ ì²˜ë¦¬
python run_statistics_crawler.py --batch --headless

# íŠ¹ì • ë‚ ì§œë¡œ ë°°ì¹˜ ì²˜ë¦¬
python run_statistics_crawler.py --batch --date "2025-08-17" --headless

# ì¬ì‹œë„ ì„¤ì • ì¡°ì •
python run_statistics_crawler.py --batch --max-retries 5 --retry-delay 10
```

### ë‹¨ì¼ ë§¤ì¥ (ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©)

```bash
python run_statistics_crawler.py --single \
  --email "account@naver.com" \
  --password "password" \
  --store-id "platform_store_id" \
  --user-id "user_uuid" \
  --headless
```

## ğŸ”„ ì‘ë™ ì›ë¦¬

### 1. URL ê¸°ë°˜ ë‚ ì§œ í•„í„° (ë‹¨ìˆœí™”ëœ ì ‘ê·¼)
```
ê¸°ì¡´: ë“œë¡­ë°•ìŠ¤ í´ë¦­ â†’ "ì¼ê°„" ì„ íƒ â†’ ë‚ ì§œ ë³€ê²½
ê°œì„ : URL íŒŒë¼ë¯¸í„°ë¡œ ì§ì ‘ ì§€ì •
https://new.smartplace.naver.com/bizes/place/{store_id}/statistics?endDate=2025-08-17&startDate=2025-08-17&term=daily&menu=reports
```

### 2. ë¡œê·¸ì¸ ì‹œìŠ¤í…œ ì¬ì‚¬ìš©
- `NaverAutoLogin` í´ë˜ìŠ¤ í™œìš©
- ë¸Œë¼ìš°ì € í”„ë¡œí•„ ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬
- 2ì°¨ ì¸ì¦ ìš°íšŒ ë©”ì»¤ë‹ˆì¦˜

### 3. ë°ì´í„° ì¶”ì¶œ ê³¼ì •
1. **ë°©ë¬¸ ì „ ì§€í‘œ**: CSS ì„ íƒìë¡œ ê° ì§€í‘œ ìˆ˜ì¹˜ì™€ ì¦ê°ë¥  ì¶”ì¶œ
2. **ë°©ë¬¸ í›„ ì§€í‘œ**: ë¦¬ë·° ë“±ë¡ í†µê³„ ì¶”ì¶œ
3. **ìœ ì… ë¶„ì„**: íƒ­ í´ë¦­ í›„ ìˆœìœ„ë³„ ë°ì´í„° ì¶”ì¶œ
4. **ë°ì´í„° ì €ì¥**: Supabase JSONB í˜•íƒœë¡œ êµ¬ì¡°í™”ëœ ë°ì´í„° ì €ì¥

### 4. ì—ëŸ¬ ì²˜ë¦¬
- **ì¬ì‹œë„ ë¡œì§**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, ë¸Œë¼ìš°ì € ë¬¸ì œ ìë™ ì¬ì‹œë„
- **ì§€ìˆ˜ì  ë°±ì˜¤í”„**: ì¬ì‹œë„ ê°„ê²© ì ì§„ì  ì¦ê°€
- **ì˜¤ë¥˜ ë¶„ë¥˜**: ì¬ì‹œë„ ê°€ëŠ¥/ë¶ˆê°€ëŠ¥ ì˜¤ë¥˜ êµ¬ë¶„

## ğŸ“Š ìˆ˜ì§‘ ë°ì´í„° ì˜ˆì‹œ

### ë°©ë¬¸ ì „ ì§€í‘œ
```json
{
  "place_inflow": 111,
  "place_inflow_change": -100.0,
  "reservation_order": 2,
  "reservation_order_change": -100.0,
  "smart_call": 3,
  "smart_call_change": -100.0
}
```

### ìœ ì… ì±„ë„ ìˆœìœ„
```json
[
  {"rank": 1, "channel_name": "ë„¤ì´ë²„ê²€ìƒ‰", "count": 46},
  {"rank": 2, "channel_name": "ë„¤ì´ë²„ì§€ë„", "count": 27},
  {"rank": 3, "channel_name": "í˜ì´ìŠ¤ë¶", "count": 23}
]
```

### ìœ ì… í‚¤ì›Œë“œ ìˆœìœ„
```json
[
  {"rank": 1, "keyword": "ì²­ì¶˜ê»ë°ê¸°", "count": 11},
  {"rank": 2, "keyword": "êµ¬ë¯¸ì¸ë™ì‚¼ê²¹ì‚´", "count": 4},
  {"rank": 3, "keyword": "ì²­ì¶˜ê»ë°ê¸°êµ¬ë¯¸", "count": 4}
]
```

## ğŸ”§ ê³ ê¸‰ ì„¤ì •

### íƒ€ì„ì•„ì›ƒ ì¡°ì •
```bash
--timeout 60000  # 60ì´ˆ (ê¸°ë³¸ê°’: 30ì´ˆ)
```

### ë¸Œë¼ìš°ì € í”„ë¡œí•„ ì´ˆê¸°í™”
```bash
--force-fresh  # ê¸°ì¡´ ì„¸ì…˜ ë¬´ì‹œí•˜ê³  ìƒˆ ë¡œê·¸ì¸
```

### ë¡œê·¸ ë””ë ‰í† ë¦¬
```
logs/browser_profiles/naver/profile_[hash]/  # ê³„ì •ë³„ ë¸Œë¼ìš°ì € í”„ë¡œí•„
```

## ğŸš¨ ì£¼ì˜ì‚¬í•­

1. **ë„¤ì´ë²„ ì„œë¹„ìŠ¤ ì•½ê´€ ì¤€ìˆ˜**: ê³¼ë„í•œ í¬ë¡¤ë§ ë°©ì§€
2. **ê³„ì • ë³´ì•ˆ**: ë¹„ë°€ë²ˆí˜¸ ì•ˆì „ ê´€ë¦¬
3. **ë¸Œë¼ìš°ì € í”„ë¡œí•„**: ë””ìŠ¤í¬ ìš©ëŸ‰ ê´€ë¦¬ í•„ìš”
4. **ëŒ€ê¸° ì‹œê°„**: ë§¤ì¥ ê°„ ì ì ˆí•œ ê°„ê²© ìœ ì§€

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¡œê·¸ì¸ ì‹¤íŒ¨
```bash
# ë¸Œë¼ìš°ì € í”„ë¡œí•„ ì´ˆê¸°í™”
--force-fresh

# íƒ€ì„ì•„ì›ƒ ì¦ê°€
--timeout 60000
```

### í˜ì´ì§€ ë¡œë”© ì‹¤íŒ¨
```bash
# í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ í•´ì œ (ë””ë²„ê¹…ìš©)
# --headless í”Œë˜ê·¸ ì œê±°

# ì¬ì‹œë„ íšŸìˆ˜ ì¦ê°€
--max-retries 5
```

### ë°ì´í„° ì¶”ì¶œ ì˜¤ë¥˜
- CSS ì„ íƒì ë³€ê²½ ì‹œ ì½”ë“œ ì—…ë°ì´íŠ¸ í•„ìš”
- í˜ì´ì§€ êµ¬ì¡° ë³€ê²½ ëª¨ë‹ˆí„°ë§

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

- **ë°°ì¹˜ í¬ê¸°**: ë§¤ì¥ë‹¹ 2ì´ˆ ê°„ê²©
- **ë©”ëª¨ë¦¬ ì‚¬ìš©**: ë¸Œë¼ìš°ì € í”„ë¡œí•„ ì¬ì‚¬ìš©ìœ¼ë¡œ ìµœì í™”
- **ë³‘ë ¬ ì²˜ë¦¬**: í˜„ì¬ëŠ” ìˆœì°¨ ì²˜ë¦¬ (ë„¤ì´ë²„ ì„œë²„ ë³´í˜¸)