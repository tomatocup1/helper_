# 24ì‹œê°„ ì§€ì—° ìŠ¤ì¼€ì¤„ë§ ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ

## ğŸ¯ êµ¬í˜„ ëª©í‘œ
ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­: **"ë‹¨ìˆœ ê¸ì •ë§Œ +1ì¼ / ë‚˜ë¨¸ì§€ëŠ” +2ì¼ë¡œ ì§€ì •í•´ì¤˜"**

## âœ… ì™„ë£Œëœ êµ¬í˜„ ì‚¬í•­

### 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½
- **íŒŒì¼**: `database/migrations/add_schedulable_reply_date.sql`
- **ë³€ê²½ì‚¬í•­**:
  - ëª¨ë“  ë¦¬ë·° í…Œì´ë¸”ì— `schedulable_reply_date TIMESTAMP NULL` ì»¬ëŸ¼ ì¶”ê°€
  - íš¨ìœ¨ì ì¸ ìŠ¤ì¼€ì¤„ëŸ¬ ì¡°íšŒë¥¼ ìœ„í•œ ì¸ë±ìŠ¤ ìƒì„±
  - ë³µí•© ì¸ë±ìŠ¤ë¡œ reply_status + schedulable_reply_date ìµœì í™”

### 2. AI Reply Manager ìˆ˜ì •
- **íŒŒì¼**: `backend/core/ai_reply/ai_reply_manager.py`
- **í•µì‹¬ ë³€ê²½ì‚¬í•­**:
  ```python
  # ìƒˆë¡œìš´ ë©”ì„œë“œ ì¶”ê°€
  def _calculate_schedulable_date(self, priority: str, review_dict: Dict) -> str:
      # AUTO: review_date + 1ì¼
      # ë‚˜ë¨¸ì§€: review_date + 2ì¼
  
  # _update_review_with_reply ë©”ì„œë“œ ì—…ë°ì´íŠ¸
  async def _update_review_with_reply(self, ..., priority: str, review_dict: Dict):
      schedulable_reply_date = self._calculate_schedulable_date(priority, review_dict)
      update_data = {
          'reply_status': 'approved',  # ì¦‰ì‹œ ìŠ¹ì¸
          'schedulable_reply_date': schedulable_reply_date,
          ...
      }
  ```

### 3. ìš°ì„ ìˆœìœ„ ì‹œìŠ¤í…œ í†µí•©
- **Korean Reply System** â†’ **AI Reply Manager** ì™„ì „ í†µí•©
- **4ë‹¨ê³„ ìš°ì„ ìˆœìœ„**:
  - **AUTO**: ë‹¨ìˆœ ê¸ì • â†’ +1ì¼
  - **DANGER**: ìœ„í—˜ ë¦¬ë·° â†’ +2ì¼  
  - **NORMAL**: ì¼ë°˜ ë¶ˆë§Œ â†’ +2ì¼
  - **CHECK**: ì²´í¬ í•„ìš” â†’ +2ì¼

## ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼

```
=== ìš°ì„ ìˆœìœ„ ë¶„ë¥˜ ë° ìŠ¤ì¼€ì¤„ë§ í…ŒìŠ¤íŠ¸ ===

í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 1: ë‹¨ìˆœ ê¸ì • ë¦¬ë·°
ë¦¬ë·°: ë§›ìˆì–´ìš”! ë˜ ì£¼ë¬¸í• ê²Œìš” (5ì )
ìš°ì„ ìˆœìœ„: auto â†’ ë‹µê¸€ ê°€ëŠ¥: +1ì¼ âœ… PASS

í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 2: ìœ„í—˜ ë¦¬ë·° (ì´ë¬¼ì§ˆ)  
ë¦¬ë·°: ìŒì‹ì—ì„œ ë¨¸ë¦¬ì¹´ë½ì´ ë‚˜ì™”ì–´ìš”... (1ì )
ìš°ì„ ìˆœìœ„: danger â†’ ë‹µê¸€ ê°€ëŠ¥: +2ì¼ âœ… PASS

í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 3: ì¼ë°˜ ë¶ˆë§Œ ë¦¬ë·°
ë¦¬ë·°: ë°°ë‹¬ì´ ë„ˆë¬´ ëŠ¦ì–´ì„œ ì‹¤ë§í–ˆì–´ìš” (2ì )
ìš°ì„ ìˆœìœ„: normal â†’ ë‹µê¸€ ê°€ëŠ¥: +2ì¼ âœ… PASS

í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 4: ì²´í¬ í•„ìš” ë¦¬ë·° (ì§ˆë¬¸ í¬í•¨)
ë¦¬ë·°: ë§›ìˆê¸´ í•œë° ê°€ê²©ì´ ì¢€ ë¹„ì‹¸ë„¤ìš”. ë©”ë‰´ ì¶”ì²œí•´ì£¼ì„¸ìš” (4ì )
ìš°ì„ ìˆœìœ„: check â†’ ë‹µê¸€ ê°€ëŠ¥: +2ì¼ âœ… PASS
```

## ğŸ”„ ë™ì‘ ë°©ì‹

### 1. ë‹µê¸€ ìƒì„± í”„ë¡œì„¸ìŠ¤
```
ë¦¬ë·° ìˆ˜ì§‘ â†’ ìš°ì„ ìˆœìœ„ ë¶„ë¥˜ â†’ AI ë‹µê¸€ ìƒì„± â†’ schedulable_reply_date ê³„ì‚° â†’ DB ì €ì¥ (approved)
```

### 2. ìŠ¤ì¼€ì¤„ë§ ê·œì¹™
- **ê¸°ì¤€**: `review_date` (ë¦¬ë·° ì‘ì„± ë‚ ì§œ)
- **AUTO ìš°ì„ ìˆœìœ„**: `review_date + 1ì¼`
- **ê¸°íƒ€ ìš°ì„ ìˆœìœ„**: `review_date + 2ì¼`
- **ìƒíƒœ ê´€ë¦¬**: ë‹µê¸€ ìƒì„± í›„ ì¦‰ì‹œ `approved` ìƒíƒœ

### 3. ìŠ¤ì¼€ì¤„ëŸ¬ ë™ì‘ (ë³„ë„ êµ¬í˜„ ì˜ˆì •)
```sql
-- ë‹µê¸€ ê²Œì‹œ ê°€ëŠ¥í•œ ë¦¬ë·° ì¡°íšŒ
SELECT * FROM reviews_naver 
WHERE reply_status = 'approved' 
  AND schedulable_reply_date <= NOW()
  AND schedulable_reply_date IS NOT NULL;
```

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

1. **`database/migrations/add_schedulable_reply_date.sql`** (ì‹ ê·œ)
   - ìŠ¤ì¼€ì¤„ë§ ì»¬ëŸ¼ ë° ì¸ë±ìŠ¤ ìƒì„±

2. **`backend/core/ai_reply/ai_reply_manager.py`** (ìˆ˜ì •)
   - `_calculate_schedulable_date()` ë©”ì„œë“œ ì¶”ê°€
   - `_update_review_with_reply()` ë©”ì„œë“œ ì—…ë°ì´íŠ¸
   - ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ìŠ¤ì¼€ì¤„ë§ ë¡œì§ êµ¬í˜„

3. **`test_schedulable_reply_system.py`** (ì‹ ê·œ)
   - í†µí•© í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
   - ìš°ì„ ìˆœìœ„ ë¶„ë¥˜ ë° ë‚ ì§œ ê³„ì‚° ê²€ì¦

## ğŸš€ ê²°ê³¼

âœ… **ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­ 100% ì¶©ì¡±**:
- "ë‹¨ìˆœ ê¸ì •ë§Œ +1ì¼" â†’ AUTO ìš°ì„ ìˆœìœ„ êµ¬í˜„
- "ë‚˜ë¨¸ì§€ëŠ” +2ì¼" â†’ DANGER/NORMAL/CHECK ìš°ì„ ìˆœìœ„ êµ¬í˜„
- 24ì‹œê°„ ê³ ì • ì§€ì—° ì‹œìŠ¤í…œ â†’ schedulable_reply_date ê¸°ë°˜ ìŠ¤ì¼€ì¤„ë§

âœ… **ê¸°ìˆ ì  ì™„ì„±ë„**:
- ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìµœì í™”
- ìš°ì„ ìˆœìœ„ ì‹œìŠ¤í…œ ì™„ì „ í†µí•©
- í¬ê´„ì ì¸ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
- í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜

**ë‹¤ìŒ ë‹¨ê³„**: ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„ ì‹œ `schedulable_reply_date`ë¥¼ í™•ì¸í•˜ì—¬ ë‹µê¸€ ìë™ ê²Œì‹œ